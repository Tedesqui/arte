<!doctype html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Diagnóstico WebXR</title>
    <style>
        body { font-family: monospace; background: #111; color: #eee; padding: 20px; font-size: 16px; line-height: 1.8; }
        #results { margin-top: 20px; padding: 15px; border: 1px solid #444; border-radius: 5px; }
        button { font-size: 18px; padding: 15px; width: 100%; border-radius: 8px; border: none; background-color: #007aff; color: white; }
        .success { color: #4caf50; font-weight: bold; }
        .fail { color: #f44336; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Diagnóstico Final de WebXR</h1>
    <button id="testButton">Realizar Teste de Diagnóstico</button>
    <div id="results">Aguardando teste...</div>

    <script>
        const testButton = document.getElementById('testButton');
        const resultsEl = document.getElementById('results');

        testButton.addEventListener('click', async () => {
            resultsEl.innerHTML = ''; // Limpa os resultados anteriores

            function log(message, status) {
                const p = document.createElement('p');
                if (status === 'success') {
                    p.className = 'success';
                } else if (status === 'fail') {
                    p.className = 'fail';
                }
                p.innerHTML = message;
                resultsEl.appendChild(p);
            }

            log('Iniciando diagnóstico...', 'info');

            // Teste 1: O navegador possui a API 'navigator.xr'?
            if ('xr' in navigator) {
                log('TESTE 1: `navigator.xr`... <span class="success">ENCONTRADO</span>', 'success');
            } else {
                log('TESTE 1: `navigator.xr`... <span class="fail">NÃO ENCONTRADO</span>. Fim do teste.', 'fail');
                return;
            }

            // Teste 2: O dispositivo suporta o modo AR básico?
            try {
                const basicSupport = await navigator.xr.isSessionSupported('immersive-ar');
                if (basicSupport) {
                    log('TESTE 2: Suporte a AR (`immersive-ar`)... <span class="success">SIM</span>', 'success');
                } else {
                    log('TESTE 2: Suporte a AR (`immersive-ar`)... <span class="fail">NÃO</span>. O dispositivo não suporta AR.', 'fail');
                    return;
                }
            } catch (e) {
                log(`TESTE 2: Suporte a AR (`immersive-ar`)... <span class="fail">ERRO: ${e.message}</span>`, 'fail');
                return;
            }
            
            // Teste 3: O dispositivo suporta o recurso 'hit-test' que precisamos?
            try {
                const hitTestSupport = await navigator.xr.isSessionSupported('immersive-ar', { requiredFeatures: ['hit-test'] });
                if (hitTestSupport) {
                    log('TESTE 3: Suporte a `hit-test`... <span class="success">SIM</span>', 'success');
                } else {
                    log('TESTE 3: Suporte a `hit-test`... <span class="fail">NÃO</span>. Este é o provável ponto de falha.', 'fail');
                }
            } catch (e) {
                log(`TESTE 3: Suporte a `hit-test`... <span class="fail">ERRO: ${e.message}</span>`, 'fail');
            }

            // Teste 4: Tentativa final de iniciar a sessão
            log('TESTE 4: Tentando iniciar a sessão de AR. Por favor, aceite a permissão da câmera se aparecer.', 'info');
            try {
                const session = await navigator.xr.requestSession('immersive-ar', { requiredFeatures: ['hit-test'] });
                log('TESTE 4: `requestSession`... <span class="success">SUCESSO!</span> A câmera deveria ter aberto.', 'success');
                session.end(); // Fecha a sessão imediatamente após o teste
            } catch (e) {
                log(`TESTE 4: `requestSession`... <span class="fail">FALHOU: ${e.message}</span>`, 'fail');
            }
        });
    </script>
</body>
</html>